// ==================================================
// Flutter Version Configuration
// ==================================================
// IMPORTANT: This block MUST be placed AFTER plugins block
// DO NOT PUT any code before plugins block

plugins {
    id "com.android.application"
    id "kotlin-android"
    id "dev.flutter.flutter-gradle-plugin"

    // ==================================================
    // FIREBASE SETUP (Optional - Uncomment if using Firebase)
    // ==================================================
    // 1. Uncomment below line
    // 2. Uncomment classpath in android/build.gradle
    // 3. Add google-services.json to android/app/
    // id "com.google.gms.google-services"
}

// ==================================================
// Version Properties (MUST be after plugins block)
// ==================================================
// Reads version from local.properties (generated by Flutter)
def localProperties = new Properties()
def localPropertiesFile = rootProject.file('local.properties')
if (localPropertiesFile.exists()) {
    localPropertiesFile.withReader('UTF-8') { reader ->
        localProperties.load(reader)
    }
}

def flutterVersionCode = localProperties.getProperty('flutter.versionCode')
if (flutterVersionCode == null) {
    flutterVersionCode = '1'
}

def flutterVersionName = localProperties.getProperty('flutter.versionName')
if (flutterVersionName == null) {
    flutterVersionName = '1.0'
}

// ==================================================
// Android App Configuration
// ==================================================
android {
    namespace "com.localguru.reports"

    // ==================================================
    // SDK Configuration
    // ==================================================
    // Google Play requires targetSdkVersion 34+ from Aug 2024
    // You can use 36 (latest) but 34 is minimum requirement
    compileSdk 36  // Can use 34, 35, or 36

    ndkVersion "27.0.12077973"

    // ==================================================
    // Java/Kotlin Compilation Options
    // ==================================================
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_17
        targetCompatibility JavaVersion.VERSION_17
        coreLibraryDesugaringEnabled true
    }

    kotlinOptions {
        jvmTarget = "17"
    }

    sourceSets {
        main.java.srcDirs += 'src/main/kotlin'
    }

    // ==================================================
    // Default Configuration
    // ==================================================
    defaultConfig {
        applicationId "in.medycart.delivery"
        minSdk 21        // Minimum Android version supported
        targetSdk 36     // Should match compileSdk (34, 35, or 36)
        versionCode flutterVersionCode.toInteger()
        versionName flutterVersionName
        multiDexEnabled true
    }

    // ==================================================
    // Build Types
    // ==================================================
    buildTypes {
        debug {
            minifyEnabled false
            shrinkResources false
        }
        release {
            signingConfig signingConfigs.debug
            minifyEnabled true    // Enable code shrinking for release
            shrinkResources true  // Enable resource shrinking for release
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }
    }

    // ==================================================
    // Lint Configuration
    // ==================================================
    // Disabled for release builds to prevent build failures
    // Set to true if you want strict lint checking
    lintOptions {
        checkReleaseBuilds false
        abortOnError false
    }
}

// ==================================================
// Dependencies
// ==================================================
dependencies {
    // Java 8+ desugaring for newer APIs on older devices
    coreLibraryDesugaring "com.android.tools:desugar_jdk_libs:2.1.4"

    // MultiDex for apps with many dependencies
    implementation "androidx.multidex:multidex:2.0.1"

    // Kotlin extensions for Android
    implementation "androidx.core:core-ktx:1.12.0"

    // ==================================================
    // FIREBASE DEPENDENCIES (Optional)
    // ==================================================
    // Uncomment if using Firebase:
    // implementation platform('com.google.firebase:firebase-bom:32.7.0')
    // implementation 'com.google.firebase:firebase-analytics'
}

// ==================================================
// Flutter Configuration
// ==================================================
flutter {
    source "../.."
}